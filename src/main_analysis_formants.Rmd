---
title: "Talker change data processing"
author: "Letitia Ho"
date: "`r format(Sys.time(), '%d %B, %Y, %H:%M')`"
output:
  html_document: default
---

```{r setup, include=FALSE}
require("knitr")
library("dplyr")
setwd('~/src/talker_change_data_processing')
source("src/main_analysis_functions.R")
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  root.dir = '~/src/talker_change_data_processing'
) 
```

``` {r load_files}
# Read files
setwd('~/src/talker_change_data_processing')
xcorr_formants <- load_data("xcorr", formants = TRUE)

# Save channel numbers
channels <- as.character(1:128)
channel_columns <- paste("X", 1:128, sep = "")
```




************

#### 5. What properties are being tracked in the meaning and talker conditions?

Tested by one-sample t-tests for significant waveform tracking in each level of each condition for each subband.

**Table 1. Proportion of significantly tracking channels**

``` {r, include=FALSE}
# Run one-sample t-tests for each condition level for each formant
t_f0_talker_s <- get_one_sample_t(subset(xcorr_formants, formant = "f0", condition = "talker", level = "S"))
t_f1_f2_talker_s <- get_one_sample_t(subset(xcorr_formants, formant = "f1_f2", condition = "talker", level = "S"))
t_f3_talker_s <- get_one_sample_t(subset(xcorr_formants, formant = "f3", condition = "talker", level = "S"))
t_f0_talker_t <- get_one_sample_t(subset(xcorr_formants, formant = "f0", condition = "talker", level = "T"))
t_f1_f2_talker_t <- get_one_sample_t(subset(xcorr_formants, formant = "f1_f2", condition = "talker", level = "T"))
t_f3_talker_t <- get_one_sample_t(subset(xcorr_formants, formant = "f3", condition = "talker", level = "T"))
t_f0_meaning_m <- get_one_sample_t(subset(xcorr_formants, formant = "f0", condition = "meaning", level = "M"))
t_f1_f2_meaning_m <- get_one_sample_t(subset(xcorr_formants, formant = "f1_f2", condition = "meaning", level = "M"))
t_f3_meaning_m <- get_one_sample_t(subset(xcorr_formants, formant = "f3", condition = "meaning", level = "M"))
t_f0_meaning_n <- get_one_sample_t(subset(xcorr_formants, formant = "f0", condition = "meaning", level = "N"))
t_f1_f2_meaning_n <- get_one_sample_t(subset(xcorr_formants, formant = "f1_f2", condition = "meaning", level = "N"))
t_f3_meaning_n <- get_one_sample_t(subset(xcorr_formants, formant = "f3", condition = "meaning", level = "N"))
t_f0_constraint_s <- get_one_sample_t(subset(xcorr_formants, formant = "f0", condition = "constraint", level = "S"))
t_f1_f2_constraint_s <- get_one_sample_t(subset(xcorr_formants, formant = "f1_f2", condition = "meaning", level = "S"))
t_f3_constraint_s <- get_one_sample_t(subset(xcorr_formants, formant = "f3", condition = "constraint", level = "S"))
t_f0_constraint_g <- get_one_sample_t(subset(xcorr_formants, formant = "f0", condition = "constraint", level = "G"))
t_f1_f2_constraint_g <- get_one_sample_t(subset(xcorr_formants, formant = "f1_f2", condition = "meaning", level = "G"))
t_f3_constraint_g <- get_one_sample_t(subset(xcorr_formants, formant = "f3", condition = "constraint", level = "G"))
```

```{r}
# Create a frequency table displaying the proportion of significant channels for each level
talker_s <- c(get_frequency_table(t_f0_talker_s)[2,2], 
              get_frequency_table(t_f1_f2_talker_s)[2,2], 
              get_frequency_table(t_f3_talker_s)[2,2])
talker_t <- c(get_frequency_table(t_f0_talker_t)[2,2], 
              get_frequency_table(t_f1_f2_talker_t)[2,2], 
              get_frequency_table(t_f3_talker_t)[2,2])
meaning_m <- c(get_frequency_table(t_f0_meaning_m)[2,2], 
              get_frequency_table(t_f1_f2_meaning_m)[2,2], 
              get_frequency_table(t_f3_meaning_m)[2,2])
meaning_n <- c(get_frequency_table(t_f0_meaning_n)[2,2], 
              get_frequency_table(t_f1_f2_meaning_n)[2,2], 
              get_frequency_table(t_f3_meaning_n)[2,2])
constraint_s <-c(get_frequency_table(t_f0_constraint_s)[2,2], 
              0, 
              get_frequency_table(t_f3_constraint_s)[2,2])
constraint_g <-c(get_frequency_table(t_f0_constraint_g)[2,2], 
              get_frequency_table(t_f1_f2_constraint_g)[2,2], 
              get_frequency_table(t_f3_constraint_g)[2,2])

df <- as.data.frame(rbind(talker_s, talker_t, meaning_m, meaning_n, constraint_s, constraint_g)) %>%
  mutate_if(is.numeric, function(x) {round(x, digits = 3)}) %>%
  mutate_if(is.numeric, function(x) {cell_spec(x, background = spec_color(x, begin = 0.5, direction = -1, scale = c(0, 0.5)))})
row.names(df) <- c("Same talker", "Different talker", "Meaningful", "Nonsense", "High constraint", "Low constraint")
# always specify scale or else it scales by column
kable(df, escape = F, col.names = c("F0", "F1 + F2", "F3")) %>%
  kable_styling(bootstrap_options = c("hover", "condensed"), full_width = F)
```

**Table 2. Channels significantly tracking the stimuli in the talker condition** 

```{r}
get_formant_frequency_table(t_f0_talker_s, t_f1_f2_talker_s, t_f3_talker_s, title = "Same talker")
get_formant_frequency_table(t_f0_talker_t, t_f1_f2_talker_t, t_f3_talker_t, title = "Different talker")
```

**Table 3. Channels significantly tracking the stimuli in the meaning condition** 

```{r}
get_formant_frequency_table(t_f0_meaning_m, t_f1_f2_meaning_m, t_f3_meaning_m, title = "Meaningful")
get_formant_frequency_table(t_f0_meaning_n, t_f1_f2_meaning_n, t_f3_meaning_n, title = "Nonsense")
```

**Table 4. Channels significantly tracking the stimuli in the constraint condition** 

```{r}
get_formant_frequency_table(t_f0_constraint_s, t_f1_f2_constraint_s, t_f3_constraint_s, title = "High constraint")
get_formant_frequency_table(t_f0_constraint_g, t_f1_f2_constraint_g, t_f3_constraint_g, title = "Low constraint")
```

