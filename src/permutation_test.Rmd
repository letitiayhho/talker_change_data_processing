---
title: "Permutation test"
author: "Letitia Ho"
date: "10/30/2020"
output: html_document
fig_width: 6
fig_height: 1
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width=12, fig.height=2)
library(ggplot2)
library(ggpubr)
```

```{r load_data, include=FALSE}
setwd("/Users/letitiaho/src/talker_change_data_processing")
original <- read.csv('data/aggregate/maximum.csv')
resampled <- read.csv('data/aggregate/resampled_maximum.csv')
```

```{r functions, include=FALSE}
subset <- function(data, channel, tag) {
  column_heading <- paste("mean_", channel, sep = "")
  subset <- data[[column_heading]][data$condition == tag]
  return(subset)
}

plot_permutations <- function(resamples, original, title = NULL) {
  ggplot(data.frame(resamples), aes(x = resamples)) +
    geom_histogram(bins = 10) +
    geom_vline(xintercept = original, color ='firebrick2', size = 2) +
    ggtitle(title)
}

plot_level <- function(resampled, original, channel_number, condition_code, title) {
  resampled_values <- subset(resampled, channel_number, condition_code)
  original_values <- subset(original, channel_number, condition_code)
  plot <- plot_permutations(resampled_values, original_values, title)
}

plot_all_levels <- function(same_talker, different_talker, 
                                meaningful, nonsense,
                                low_constraint, high_constraint) {
  ggarrange(same_talker, different_talker, 
            meaningful, nonsense,
            low_constraint, high_constraint,
            ncol = 6, nrow = 1)
}

plot_channel <- function(resampled, original, channel_number) {
  same_talker <- plot_level(resampled, original, channel_number, "S", 
                            paste(channel_number, ": Same Talker", sep = ""))
  different_talker <- plot_level(resampled, original, channel_number, "T",
                            paste(channel_number, ": Different Talker", sep = ""))
  meaningful <- plot_level(resampled, original, channel_number, "M",
                            paste(channel_number, ": Meaningful", sep = ""))
  nonsense <- plot_level(resampled, original, channel_number, "N",
                            paste(channel_number, ": Nonsense", sep = ""))
  low_constraint <- plot_level(resampled, original, channel_number, "L",
                            paste(channel_number, ": Low constraint", sep = ""))
  high_constraint <- plot_level(resampled, original, channel_number, "H",
                            paste(channel_number, ": High constraint", sep = ""))
  
  plot_all_levels(same_talker, different_talker, 
                  meaningful, nonsense,
                  low_constraint, high_constraint)
}
```

### Plot graphs
```{r}
plot_channel(resampled, original, "1")
plot_channel(resampled, original, "2")
plot_channel(resampled, original, "3")
```

### Calculate statistics
```{r}

```

