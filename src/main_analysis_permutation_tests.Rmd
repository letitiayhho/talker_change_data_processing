---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
require("knitr")
library("dplyr")
library("kableExtra")
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE
) 
```

```{r load_files}
setwd("~/src/talker_change_data_processing")
source("src/main_analysis_functions.R")
avg <- read.csv("data/aggregate/cross_correlations_abs_average.csv")
```




******

#### 1. Are any channels significantly tracking the stimuli?

Conducting a bootstrapping permutation test that scrambles the stimuli order within each subject then computes cross correlations between eeg-signals and the scrambled stimuli. This resampling is repeated 1000 times and the mean absolute cross-correlation for channel over all conditions is calculated each time to generate null values. The number of null values greater than the observed channel cross correlation is divided by the number of resamplings to yield the *p*-value of the permutation test. A channel with a mean cross-correlation with *p* < 0.05 is considered to be significantly tracking the stimuli.

``` {r}
# Calculate group means
talker <- aggregate(avg[, 5:132], list(talker = avg$talker, subject = avg$subject), mean)
meaning <- aggregate(avg[, 5:132], list(meaning = avg$meaning, subject = avg$subject), mean)
constraint <- aggregate(avg[, 5:132], list(constraint = avg$constraint, subject = avg$subject), mean)
```

*Basic t-tests *

```{r, warning=FALSE, echo=TRUE}
# One-sample t-test against mu=0
t_talker_S <- get_one_sample_t(subset(talker, condition = "talker", level = "S"))
t_talker_T <- get_one_sample_t(subset(talker, condition = "talker", level = "T"))
t_meaning_M <- get_one_sample_t(subset(talker, condition = "meaning", level = "M"))
t_meaning_N <- get_one_sample_t(subset(talker, condition = "meaning", level = "N"))
t_constraint_S <- get_one_sample_t(subset(talker, condition = "constraint", level = "S"))
t_constraint_G <- get_one_sample_t(subset(talker, condition = "constraint", level = "G"))

# Number of significant channels
kable(cbind(talker_s = sum(t_talker_S$p < 0.05),
            talker_t = sum(t_talker_T$p < 0.05),
            meaning_m = sum(t_meaning_M$p < 0.05),
            meaning_n = sum(t_meaning_N$p < 0.05),
            constraint_s = sum(t_constraint_S$p < 0.05),
            constraint_g = sum(t_constraint_G$p < 0.05))) %>%
      kable_styling(c("striped", "condensed"), full_width = F)
```

```{r, echo=TRUE}
# Paired samples t-test between levels
t_talker <- get_paired_samples_t(subset(talker, condition = "talker", level = "S"),
                                 subset(talker, condition = "talker", level = "T"))
t_meaning <- get_paired_samples_t(subset(talker, condition = "meaning", level = "M"),
                                  subset(talker, condition = "meaning", level = "N"))
t_constraint <- get_paired_samples_t(subset(talker, condition = "constraint", level = "S"),
                                     subset(talker, condition = "constraint", level = "G"))

# Number of significant channels
kable(cbind(talker = sum(t_talker$p < 0.05),
            meaning = sum(t_meaning$p < 0.05),
            constraint = sum(t_constraint$p < 0.05))) %>%
      kable_styling(c("striped", "condensed"), full_width = F)

# List of not-significant channels
which(t_talker$p > 0.05)
which(t_meaning$p > 0.05)
which(t_constraint$p > 0.05)
```





******

#### 2. Are any channels tracking the stimuli significantly differently across conditions?

Probably also want to scramble stimuli and eeg for first permutation test first. then do the paired-samples permutation test


A permutation test will be conducted to see whether there is significant stimuli tracking in each condition level. The levels for each condition will be scrambled, for example in the talker condition same and different talker groupings will be randomized. In each iteration, the mean cross correlation for each level will computed and compared to the means computed for under the original grouping. This resampling will also be repeated 1000 times and the *p*-value will again be computed as the number of samples with a more extreme mean than the original. Channels with *p* < 0.05 for a condition levels are channels that significantly track the stimuli in that level.

We will also conduct a permutation test to see if channels track the levels within a condition differently. To do this a permutation test over the difference in cross-correlations between the two levels will be computed. Again the level groupings will be randomized for 1000 iterations. Channels with *p* < 0.05 are ones that track the two condition levels significantly different. Channels with *p* < 0.05 for this permutation test and *p* < 0.05 for any one of the one-sample permutation test above are channels that preferetially track one level in the condition over another. For example, if a channel tracks different and same-talker words differently and significantly tracks different-talker words that channel preferentially tracks different-talker words.

The difference in tracking between levels within a condition will also be tested. 


Conducting a bootstrapping permutation test that scrambles eeg-stimuli cross-correlation values between the two levels of each condition. This resampling is repeated 1000 times and the mean absolute cross-correlation for channel over for each condition level is calculated each time to generate null values. The number of null values greater than the observed channel cross correlation is divided by the number of resamplings to yield the *p*-value of the permutation test. A channel with a mean cross-correlation with *p* < 0.05 for a condition level is considered to be significantly tracking the stimuli in that condition. 

Bootstrapping will also be conducted between levels. For each resampling the difference between the means of each level within a condition will be computed. 

significant tracking for a single level
significantly different tracking between levels

scramble groups S&T, find mean for condition T, find mean for condition S


``` {r}

```




******

#### 3. Is there a difference in topology of cortical tracking between conditions?
