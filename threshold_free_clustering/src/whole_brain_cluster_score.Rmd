---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r setup, warning=FALSE}
# knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
knitr::opts_knit$set(root.dir = "/Users/letitiaho/src/talker_change_data_processing/")
setwd("/Users/letitiaho/src/talker_change_data_processing/")
library("dplyr")
library("ggplot2")
library("ggpubr")
library("kableExtra")
source("tools/functions.R")
source("threshold_free_clustering/src/functions.R")
```

```{r}
(var_names <- load("8_wilcoxon/data/full_wilcoxon_results.RData"))
```

**Compute distance score**

```{r}
# Compute pairwise distances
coordinates <- get_coordinates()
distances <- get_pairwise_distances(coordinates)
get_histogram_of_pairwise_distances(distances)

# Get distance score by standardizing then taking the inverse of the distance
distance_scores <- get_distance_score(distances)
get_histogram_of_pairwise_distances(distance_scores)
```

**Compute weight**
```{r}
S_weight_scores <- sigmoid(S_w$w)
S_hist <- histogram(S_weight_scores, title = "S", xlim = c(0.5, 1.5))
T_weight_scores <- sigmoid(T_w$w)
T_hist <- histogram(T_weight_scores, title = "T", xlim = c(0.5, 1.5))
M_weight_scores <- sigmoid(M_w$w)
M_hist <- histogram(M_weight_scores, title = "M", xlim = c(0.5, 1.5))
N_weight_scores <- sigmoid(N_w$w)
N_hist <- histogram(N_weight_scores, title = "N", xlim = c(0.5, 1.5))
L_weight_scores <- sigmoid(L_w$w)
L_hist <- histogram(L_weight_scores, title = "L", xlim = c(0.5, 1.5))
H_weight_scores <- sigmoid(H_w$w)
H_hist <- histogram(H_weight_scores, title = "H", xlim = c(0.5, 1.5))
plot <- ggarrange(S_hist, T_hist, M_hist, N_hist, L_hist, H_hist, ncol = 2, nrow = 3)
plot
ggsave(plot, filename = '~/Desktop/hist.png', width = 12, height = 4)
```

**Compute cluster scores**
```{r}
S_cluster_scores <- get_cluster_scores(distance_scores, S_weight_scores)
T_cluster_scores <- get_cluster_scores(distance_scores, T_weight_scores)
M_cluster_scores <- get_cluster_scores(distance_scores, M_weight_scores)
N_cluster_scores <- get_cluster_scores(distance_scores, N_weight_scores)
L_cluster_scores <- get_cluster_scores(distance_scores, L_weight_scores)
H_cluster_scores <- get_cluster_scores(distance_scores, H_weight_scores)
```

```{r}
S_permuted <- permute_clusters(distance_scores, S_weight_scores, 1000)
save(S_permuted, file = "threshold_free_clustering/data/S_permuted.RData")
T_permuted <- permute_clusters(distance_scores, T_weight_scores, 1000)
save(T_permuted, file = "threshold_free_clustering/data/T_permuted.RData")
M_permuted <- permute_clusters(distance_scores, M_weight_scores, 1000)
save(M_permuted, file = "threshold_free_clustering/data/M_permuted.RData")
N_permuted <- permute_clusters(distance_scores, N_weight_scores, 1000)
save(N_permuted, file = "threshold_free_clustering/data/N_permuted.RData")
L_permuted <- permute_clusters(distance_scores, L_weight_scores, 1000)
save(L_permuted, file = "threshold_free_clustering/data/L_permuted.RData")
H_permuted <- permute_clusters(distance_scores, H_weight_scores, 1000)
save(H_permuted, file = "threshold_free_clustering/data/H_permuted.RData")
```

```{r}
histogram(S_permuted$sum, S_cluster_scores$sum, title = "Same")
histogram(T_permuted$sum, T_cluster_scores$sum, title = "Different")
histogram(M_permuted$sum, M_cluster_scores$sum, title = "Meaningful")
histogram(N_permuted$sum, N_cluster_scores$sum, title = "Nonsense")
histogram(L_permuted$sum, L_cluster_scores$sum, title = "Low constraint")
histogram(H_permuted$sum, H_cluster_scores$sum, title = "High constraint")
```

**Two-sample, between levels**

```{r}
# Talker
talker_weight_scores <- sigmoid(talker_w$w)
talker_cluster_scores <- get_cluster_scores(distance_scores, talker_weight_scores)
talker_permuted <- permute_clusters(distance_scores, talker_weight_scores, 100)
histogram(talker_permuted$sum, talker_cluster_scores$sum, title = "Talker")
```

```{r}
# Meaning
meaning_weight_scores <- sigmoid(meaning_w$w)
meaning_cluster_scores <- get_cluster_scores(distance_scores, meaning_weight_scores)
meaning_permuted <- permute_clusters(distance_scores, meaning_weight_scores, 100)
histogram(meaning_permuted$sum, meaning_cluster_scores$sum, title = "Meaning")
```

```{r}
# Constraint
constraint_weight_scores <- sigmoid(constraint_w$w)
constraint_cluster_scores <- get_cluster_scores(distance_scores, constraint_weight_scores)
constraint_permuted <- permute_clusters(distance_scores, constraint_weight_scores, 100)
histogram(constraint_permuted$sum, constraint_cluster_scores$sum, title = "Constraint")
```


